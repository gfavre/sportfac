"use strict";var sportfacModule=angular.module("sportfac",["sportfac.services","ui.calendar"]);sportfacModule.config(["$routeProvider",function(e){e.when("/activity/:activityId/timeline",{templateUrl:"/static/partials/timeline.html",controller:"ActivityTimelineCtrl"});e.when("/activity/:activityId/detail",{templateUrl:"/static/partials/activity-detail.html",controller:"ActivityDetailCtrl"});e.otherwise({redirectTo:"/activities"})}]);sportfacModule.config(function(e){e.startSymbol("{[{");e.endSymbol("}]}")});var ActivityCtrl=function(e,t){e.getUserChildren=function(){t.get("/api/family/").success(function(t){e.userChildren=t;e.selectChild(0)})};e.selectChild=function(t){e.selectedChild&&(e.selectedChild.selected=!1);e.selectedChild=e.userChildren[t];e.selectedChild.selected=!0};e.getDetailedActivity=function(e,n){var r="/api/activities/"+e;t({url:r,method:"GET",cache:!0}).success(function(e){n(e)})};e.selectActivity=function(t){e.selectedActivity&&(e.selectedActivity.selected=!1);t.selected=!0;e.selectedActivity=t};e.getUserChildren()},ActivityListCtrl=function(e,t){e.loadActivities=function(){var n="/api/activities/?year="+e.selectedChild.school_year;e.activities=t({method:"GET",url:n,cache:!0}).then(function(e){return e.data})};e.$watch("selectedChild",function(){e.loadActivities()})},ActivityTimelineCtrl=function(e,t,n,r){e.eventSources=[];var i=new Date,s=i.getDate(),o=i.getMonth(),u=i.getFullYear();e.changeActivity=function(t){console.log(t);e.events.length=0;for(var r=0;r<t.courses.length;r++){var a=t.courses[r];if(a.schoolyear_min>e.selectedChild.school_year||a.schoolyear_max<e.selectedChild.school_year)continue;var f=new Date(u,o,s+(a.day-i.getDay()),a.start_time.split(":")[0],a.start_time.split(":")[1]),l=new Date(u,o,s+(a.day-i.getDay()),a.end_time.split(":")[0],a.end_time.split(":")[1]);e.events.push({title:t.name+" \n "+n("date")(a.start_date,"mediumDate")+" - "+n("date")(a.end_date,"mediumDate"),start:f,end:l,allDay:!1,color:"#0088cc",course:a})}};e.eventClick=function(t,n,i){t.color="green";debugger;r.addCourse(e.selectedChild,t);e.weekagenda.fullCalendar("updateEvent",t)};e.events=[];e.registeredEvents=function(t,n,i){var s=r.getCalendar(e.selectedChild);i(s)};e.othersEvents=[];e.eventSources=[e.events,e.registeredEvents];e.getDetailedActivity(t.activityId,function(t){e.detailedActivity=t;e.changeActivity(t);e.weekagenda.fullCalendar("render")});e.uiConfig={calendar:{height:500,aspectRatio:4,year:u,month:o,date:s,editable:!1,defaultView:"agendaWeek",weekends:!1,allDaySlot:!1,slotMinutes:15,firstHour:12,maxTime:20,minTime:12,axisFormat:"H:mm",columnFormat:"dddd",dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],header:{left:"",center:"",right:""},eventClick:function(){e.$apply(e.eventClick)},timeFormat:{agenda:""},lazyFetching:!1}}},ActivityDetailCtrl=function(e,t){e.activityId=t.activityId;e.activityId!=undefined&&e.getDetailedActivity({id:e.activityId})};