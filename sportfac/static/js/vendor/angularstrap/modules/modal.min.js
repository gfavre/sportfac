/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.modal",["mgcrea.ngStrap.helpers.dimensions"]).provider("$modal",function(){var e=this.defaults={animation:"am-fade",backdropAnimation:"am-fade",prefixClass:"modal",prefixEvent:"modal",placement:"top",template:"modal/modal.tpl.html",contentTemplate:!1,container:!1,element:null,backdrop:!0,keyboard:!0,html:!1,show:!0};this.$get=["$window","$rootScope","$compile","$q","$templateCache","$http","$animate","$timeout","$sce","dimensions",function(t,n,r,i,s,o,u,a,f,l){function m(t){function b(){o.$emit(s.prefixEvent+".show",i)}function E(){o.$emit(s.prefixEvent+".hide",i);d.removeClass(s.prefixClass+"-open");s.animation&&d.removeClass(s.prefixClass+"-with-"+s.animation)}function S(e){if(e.target!==e.currentTarget)return;s.backdrop==="static"?i.focus():i.hide()}function x(e){e.preventDefault()}var i={},s=i.$options=angular.extend({},e,t);i.$promise=w(s.template);var o=i.$scope=s.scope&&s.scope.$new()||n.$new();!s.element&&!s.container&&(s.container="body");i.$id=s.id||s.element&&s.element.attr("id")||"";c(["title","content"],function(e){s[e]&&(o[e]=f.trustAsHtml(s[e]))});o.$hide=function(){o.$$postDigest(function(){i.hide()})};o.$show=function(){o.$$postDigest(function(){i.show()})};o.$toggle=function(){o.$$postDigest(function(){i.toggle()})};i.$isShown=o.$isShown=!1;s.contentTemplate&&(i.$promise=i.$promise.then(function(e){var n=angular.element(e);return w(s.contentTemplate).then(function(e){var r=y('[ng-bind="content"]',n[0]).removeAttr("ng-bind").html(e);t.template||r.next().remove();return n[0].outerHTML})}));var a,l,m=angular.element('<div class="'+s.prefixClass+'-backdrop"/>');i.$promise.then(function(e){angular.isObject(e)&&(e=e.data);s.html&&(e=e.replace(v,'ng-bind-html="'));e=h.apply(e);a=r(e);i.init()});i.init=function(){s.show&&o.$$postDigest(function(){i.show()})};i.destroy=function(){if(l){l.remove();l=null}if(m){m.remove();m=null}o.$destroy()};i.show=function(){if(i.$isShown)return;if(o.$emit(s.prefixEvent+".show.before",i).defaultPrevented)return;var e,t;if(angular.isElement(s.container)){e=s.container;t=s.container[0].lastChild?angular.element(s.container[0].lastChild):null}else if(s.container){e=y(s.container);t=e[0].lastChild?angular.element(e[0].lastChild):null}else{e=null;t=s.element}l=i.$element=a(o,function(e,t){});l.css({display:"block"}).addClass(s.placement);if(s.animation){s.backdrop&&m.addClass(s.backdropAnimation);l.addClass(s.animation)}s.backdrop&&u.enter(m,d,null);var n=u.enter(l,e,t,b);n&&n.then&&n.then(b);i.$isShown=o.$isShown=!0;g(o);var r=l[0];p(function(){r.focus()});d.addClass(s.prefixClass+"-open");s.animation&&d.addClass(s.prefixClass+"-with-"+s.animation);if(s.backdrop){l.on("click",S);m.on("click",S);m.on("wheel",x)}s.keyboard&&l.on("keyup",i.$onKeyUp)};i.hide=function(){if(!i.$isShown)return;if(o.$emit(s.prefixEvent+".hide.before",i).defaultPrevented)return;var e=u.leave(l,E);e&&e.then&&e.then(E);s.backdrop&&u.leave(m);i.$isShown=o.$isShown=!1;g(o);if(s.backdrop){l.off("click",S);m.off("click",S);m.off("wheel",x)}s.keyboard&&l.off("keyup",i.$onKeyUp)};i.toggle=function(){i.$isShown?i.hide():i.show()};i.focus=function(){l[0].focus()};i.$onKeyUp=function(e){if(e.which===27&&i.$isShown){i.hide();e.stopPropagation()}};return i}function g(e){e.$$phase||e.$root&&e.$root.$$phase||e.$digest()}function y(e,t){return angular.element((t||document).querySelectorAll(e))}function w(e){return b[e]?b[e]:b[e]=i.when(s.get(e)||o.get(e)).then(function(t){if(angular.isObject(t)){s.put(e,t.data);return t.data}return t})}var c=angular.forEach,h=String.prototype.trim,p=t.requestAnimationFrame||t.setTimeout,d=angular.element(t.document.body),v=/ng-bind="/ig,b={};return m}]}).directive("bsModal",["$window","$sce","$modal",function(e,t,n){return{restrict:"EAC",scope:!0,link:function(r,i,s,o){var u={scope:r,element:i,show:!1};angular.forEach(["template","contentTemplate","placement","backdrop","keyboard","html","container","animation","id"],function(e){angular.isDefined(s[e])&&(u[e]=s[e])});angular.forEach(["title","content"],function(e){s[e]&&s.$observe(e,function(n,i){r[e]=t.trustAsHtml(n)})});s.bsModal&&r.$watch(s.bsModal,function(e,t){angular.isObject(e)?angular.extend(r,e):r.content=e},!0);var a=n(u);i.on(s.trigger||"click",a.toggle);r.$on("$destroy",function(){a&&a.destroy();u=null;a=null})}}}]);