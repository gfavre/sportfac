/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.select",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$select",function(){var e=this.defaults={animation:"am-fade",prefixClass:"select",prefixEvent:"$select",placement:"bottom-left",template:"select/select.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,multiple:!1,allNoneButtons:!1,sort:!0,caretHtml:'&nbsp;<span class="caret"></span>',placeholder:"Choose among the following...",allText:"All",noneText:"None",maxLength:3,maxLengthHtml:"selected",iconCheckmark:"glyphicon glyphicon-ok"};this.$get=["$window","$document","$rootScope","$tooltip","$timeout",function(t,n,r,i,s){function f(t,n,r){var o={},u=angular.extend({},e,r);o=i(t,u);var f=o.$scope;f.$matches=[];f.$activeIndex=0;f.$isMultiple=u.multiple;f.$showAllNoneButtons=u.allNoneButtons&&u.multiple;f.$iconCheckmark=u.iconCheckmark;f.$allText=u.allText;f.$noneText=u.noneText;f.$activate=function(e){f.$$postDigest(function(){o.activate(e)})};f.$select=function(e,t){f.$$postDigest(function(){o.select(e)})};f.$isVisible=function(){return o.$isVisible()};f.$isActive=function(e){return o.$isActive(e)};f.$selectAll=function(){for(var e=0;e<f.$matches.length;e++)f.$isActive(e)||f.$select(e)};f.$selectNone=function(){for(var e=0;e<f.$matches.length;e++)f.$isActive(e)&&f.$select(e)};o.update=function(e){f.$matches=e;o.$updateActiveIndex()};o.activate=function(e){if(u.multiple){f.$activeIndex.sort();o.$isActive(e)?f.$activeIndex.splice(f.$activeIndex.indexOf(e),1):f.$activeIndex.push(e);u.sort&&f.$activeIndex.sort()}else f.$activeIndex=e;return f.$activeIndex};o.select=function(e){var t=f.$matches[e].value;f.$apply(function(){o.activate(e);if(u.multiple)n.$setViewValue(f.$activeIndex.map(function(e){return f.$matches[e].value}));else{n.$setViewValue(t);o.hide()}});f.$emit(u.prefixEvent+".select",t,e,o)};o.$updateActiveIndex=function(){n.$modelValue&&f.$matches.length?u.multiple&&angular.isArray(n.$modelValue)?f.$activeIndex=n.$modelValue.map(function(e){return o.$getIndex(e)}):f.$activeIndex=o.$getIndex(n.$modelValue):f.$activeIndex>=f.$matches.length&&(f.$activeIndex=u.multiple?[]:0)};o.$isVisible=function(){return!u.minLength||!n?f.$matches.length:f.$matches.length&&n.$viewValue.length>=u.minLength};o.$isActive=function(e){return u.multiple?f.$activeIndex.indexOf(e)!==-1:f.$activeIndex===e};o.$getIndex=function(e){var t=f.$matches.length,n=t;if(!t)return;for(n=t;n--;)if(f.$matches[n].value===e)break;if(n<0)return;return n};o.$onMouseDown=function(e){e.preventDefault();e.stopPropagation();if(a){var t=angular.element(e.target);t.triggerHandler("click")}};o.$onKeyDown=function(e){if(!/(9|13|38|40)/.test(e.keyCode))return;e.preventDefault();e.stopPropagation();if(!u.multiple&&(e.keyCode===13||e.keyCode===9))return o.select(f.$activeIndex);e.keyCode===38&&f.$activeIndex>0?f.$activeIndex--:e.keyCode===40&&f.$activeIndex<f.$matches.length-1?f.$activeIndex++:angular.isUndefined(f.$activeIndex)&&(f.$activeIndex=0);f.$digest()};var l=o.show;o.show=function(){l();u.multiple&&o.$element.addClass("select-multiple");s(function(){o.$element.on(a?"touchstart":"mousedown",o.$onMouseDown);u.keyboard&&t.on("keydown",o.$onKeyDown)},0,!1)};var c=o.hide;o.hide=function(){o.$element.off(a?"touchstart":"mousedown",o.$onMouseDown);u.keyboard&&t.off("keydown",o.$onKeyDown);c(!0)};return o}var o=angular.element(t.document.body),u=/(ip(a|o)d|iphone|android)/ig.test(t.navigator.userAgent),a="createTouch"in t.document&&u;f.defaults=e;return f}]}).directive("bsSelect",["$window","$parse","$q","$select","$parseOptions",function(e,t,n,r,i){var s=r.defaults;return{restrict:"EAC",require:"ngModel",link:function(t,n,o,u){var a={scope:t,placeholder:s.placeholder};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","placeholder","multiple","allNoneButtons","maxLength","maxLengthHtml","allText","noneText","iconCheckmark","autoClose","id"],function(e){angular.isDefined(o[e])&&(a[e]=o[e])});if(n[0].nodeName.toLowerCase()==="select"){var f=n;f.css("display","none");n=angular.element('<button type="button" class="btn btn-default"></button>');f.after(n)}var l=i(o.ngOptions),c=r(n,u,a),h=l.$match[7].replace(/\|.+/,"").trim();t.$watch(h,function(e,n){l.valuesFn(t,u).then(function(e){c.update(e);u.$render()})},!0);t.$watch(o.ngModel,function(e,t){c.$updateActiveIndex();u.$render()},!0);u.$render=function(){var e,t;if(a.multiple&&angular.isArray(u.$modelValue)){e=u.$modelValue.map(function(e){t=c.$getIndex(e);return angular.isDefined(t)?c.$scope.$matches[t].label:!1}).filter(angular.isDefined);e.length>(a.maxLength||s.maxLength)?e=e.length+" "+(a.maxLengthHtml||s.maxLengthHtml):e=e.join(", ")}else{t=c.$getIndex(u.$modelValue);e=angular.isDefined(t)?c.$scope.$matches[t].label:!1}n.html((e?e:a.placeholder)+s.caretHtml)};a.multiple&&(u.$isEmpty=function(e){return!e||e.length===0});t.$on("$destroy",function(){c&&c.destroy();a=null;c=null})}}}]);