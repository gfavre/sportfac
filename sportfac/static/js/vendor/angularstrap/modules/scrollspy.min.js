/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.scrollspy",["mgcrea.ngStrap.helpers.debounce","mgcrea.ngStrap.helpers.dimensions"]).provider("$scrollspy",function(){var e=this.$$spies={},t=this.defaults={debounce:150,throttle:100,offset:100};this.$get=["$window","$document","$rootScope","dimensions","debounce","throttle",function(n,r,i,s,o,u){function c(e,t){return e[0].nodeName&&e[0].nodeName.toLowerCase()===t.toLowerCase()}function h(r){var h=angular.extend({},t,r);h.element||(h.element=l);var p=c(h.element,"body"),d=p?a:h.element,v=p?"window":h.id;if(e[v]){e[v].$$count++;return e[v]}var m={},g,y,b=m.$trackedElements=[],w=[],E,S,x,T,N,C;m.init=function(){this.$$count=1;S=o(this.checkPosition,h.debounce);x=u(this.checkPosition,h.throttle);d.on("click",this.checkPositionWithEventLoop);a.on("resize",S);d.on("scroll",x);T=o(this.checkOffsets,h.debounce);g=i.$on("$viewContentLoaded",T);y=i.$on("$includeContentLoaded",T);T();v&&(e[v]=m)};m.destroy=function(){this.$$count--;if(this.$$count>0)return;d.off("click",this.checkPositionWithEventLoop);a.off("resize",S);d.off("scroll",x);g();y();v&&delete e[v]};m.checkPosition=function(){if(!w.length)return;C=(p?n.pageYOffset:d.prop("scrollTop"))||0;N=Math.max(n.innerHeight,f.prop("clientHeight"));if(C<w[0].offsetTop&&E!==w[0].target)return m.$activateElement(w[0]);for(var e=w.length;e--;){if(angular.isUndefined(w[e].offsetTop)||w[e].offsetTop===null)continue;if(E===w[e].target)continue;if(C<w[e].offsetTop)continue;if(w[e+1]&&C>w[e+1].offsetTop)continue;return m.$activateElement(w[e])}};m.checkPositionWithEventLoop=function(){setTimeout(m.checkPosition,1)};m.$activateElement=function(e){if(E){var t=m.$getTrackedElement(E);if(t){t.source.removeClass("active");c(t.source,"li")&&c(t.source.parent().parent(),"li")&&t.source.parent().parent().removeClass("active")}}E=e.target;e.source.addClass("active");c(e.source,"li")&&c(e.source.parent().parent(),"li")&&e.source.parent().parent().addClass("active")};m.$getTrackedElement=function(e){return b.filter(function(t){return t.target===e})[0]};m.checkOffsets=function(){angular.forEach(b,function(e){var t=document.querySelector(e.target);e.offsetTop=t?s.offset(t).top:null;h.offset&&e.offsetTop!==null&&(e.offsetTop-=h.offset*1)});w=b.filter(function(e){return e.offsetTop!==null}).sort(function(e,t){return e.offsetTop-t.offsetTop});S()};m.trackElement=function(e,t){b.push({target:e,source:t})};m.untrackElement=function(e,t){var n;for(var r=b.length;r--;)if(b[r].target===e&&b[r].source===t){n=r;break}b=b.splice(n,1)};m.activate=function(e){b[e].addClass("active")};m.init();return m}var a=angular.element(n),f=angular.element(r.prop("documentElement")),l=angular.element(n.document.body);return h}]}).directive("bsScrollspy",["$rootScope","debounce","dimensions","$scrollspy",function(e,t,n,r){return{restrict:"EAC",link:function(t,n,i){var s={scope:t};angular.forEach(["offset","target"],function(e){angular.isDefined(i[e])&&(s[e]=i[e])});var o=r(s);o.trackElement(s.target,n);t.$on("$destroy",function(){if(o){o.untrackElement(s.target,n);o.destroy()}s=null;o=null})}}}]).directive("bsScrollspyList",["$rootScope","debounce","dimensions","$scrollspy",function(e,t,n,r){return{restrict:"A",compile:function(t,n){var r=t[0].querySelectorAll("li > a[href]");angular.forEach(r,function(e){var t=angular.element(e);t.parent().attr("bs-scrollspy","").attr("data-target",t.attr("href"))})}}}]);