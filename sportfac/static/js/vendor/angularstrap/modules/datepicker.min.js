/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.datepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.helpers.dateFormatter","mgcrea.ngStrap.tooltip"]).provider("$datepicker",function(){var e=this.defaults={animation:"am-fade",prefixClass:"datepicker",placement:"bottom-left",template:"datepicker/datepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!1,dateType:"date",dateFormat:"shortDate",modelDateFormat:null,dayFormat:"dd",monthFormat:"MMM",yearFormat:"yyyy",monthTitleFormat:"MMMM yyyy",yearTitleFormat:"yyyy",strictFormat:!1,autoclose:!1,minDate:-Infinity,maxDate:+Infinity,startView:0,minView:0,startWeek:0,daysOfWeekDisabled:"",iconLeft:"glyphicon glyphicon-chevron-left",iconRight:"glyphicon glyphicon-chevron-right"};this.$get=["$window","$document","$rootScope","$sce","$dateFormatter","datepickerViews","$tooltip","$timeout",function(t,n,r,i,s,o,u,a){function h(t,n,r){function m(e){e.selected=i.$isSelected(e.date)}function g(){t[0].focus()}var i=u(t,angular.extend({},e,r)),s=r.scope,f=i.$options,h=i.$scope;f.startView&&(f.startView-=f.minView);var p=o(i);i.$views=p.views;var d=p.viewDate;h.$mode=f.startView;h.$iconLeft=f.iconLeft;h.$iconRight=f.iconRight;var v=i.$views[h.$mode];h.$select=function(e){i.select(e)};h.$selectPane=function(e){i.$selectPane(e)};h.$toggleMode=function(){i.setMode((h.$mode+1)%i.$views.length)};i.update=function(e){if(angular.isDate(e)&&!isNaN(e.getTime())){i.$date=e;v.update.call(v,e)}i.$build(!0)};i.updateDisabledDates=function(e){f.disabledDateRanges=e;for(var t=0,n=h.rows.length;t<n;t++)angular.forEach(h.rows[t],i.$setDisabledEl)};i.select=function(e,t){angular.isDate(n.$dateValue)||(n.$dateValue=new Date(e));if(!h.$mode||t){n.$setViewValue(angular.copy(e));n.$render();f.autoclose&&!t&&a(function(){i.hide(!0)})}else{angular.extend(d,{year:e.getFullYear(),month:e.getMonth(),date:e.getDate()});i.setMode(h.$mode-1);i.$build()}};i.setMode=function(e){h.$mode=e;v=i.$views[h.$mode];i.$build()};i.$build=function(e){if(e===!0&&v.built)return;if(e===!1&&!v.built)return;v.build.call(v)};i.$updateSelected=function(){for(var e=0,t=h.rows.length;e<t;e++)angular.forEach(h.rows[e],m)};i.$isSelected=function(e){return v.isSelected(e)};i.$setDisabledEl=function(e){e.disabled=v.isDisabled(e.date)};i.$selectPane=function(e){var t=v.steps,n=new Date(Date.UTC(d.year+(t.year||0)*e,d.month+(t.month||0)*e,1));angular.extend(d,{year:n.getUTCFullYear(),month:n.getUTCMonth(),date:n.getUTCDate()});i.$build()};i.$onMouseDown=function(e){e.preventDefault();e.stopPropagation();if(c){var t=angular.element(e.target);t[0].nodeName.toLowerCase()!=="button"&&(t=t.parent());t.triggerHandler("click")}};i.$onKeyDown=function(e){if(!/(38|37|39|40|13)/.test(e.keyCode)||e.shiftKey||e.altKey)return;e.preventDefault();e.stopPropagation();if(e.keyCode===13)return h.$mode?h.$apply(function(){i.setMode(h.$mode-1)}):i.hide(!0);v.onKeyDown(e);s.$digest()};var y=i.init;i.init=function(){if(l&&f.useNative){t.prop("type","date");t.css("-webkit-appearance","textfield");return}if(c){t.prop("type","text");t.attr("readonly","true");t.on("click",g)}y()};var b=i.destroy;i.destroy=function(){l&&f.useNative&&t.off("click",g);b()};var w=i.show;i.show=function(){w();a(function(){if(!i.$isShown)return;i.$element.on(c?"touchstart":"mousedown",i.$onMouseDown);f.keyboard&&t.on("keydown",i.$onKeyDown)},0,!1)};var E=i.hide;i.hide=function(e){if(!i.$isShown)return;i.$element.off(c?"touchstart":"mousedown",i.$onMouseDown);f.keyboard&&t.off("keydown",i.$onKeyDown);E(e)};return i}var f=angular.element(t.document.body),l=/(ip(a|o)d|iphone|android)/ig.test(t.navigator.userAgent),c="createTouch"in t.document&&l;e.lang||(e.lang=s.getDefaultLocale());h.defaults=e;return h}]}).directive("bsDatepicker",["$window","$parse","$q","$dateFormatter","$dateParser","$datepicker",function(e,t,n,r,i,s){var o=s.defaults,u=/(ip(a|o)d|iphone|android)/ig.test(e.navigator.userAgent);return{restrict:"EAC",require:"ngModel",link:function(t,n,o,a){function d(e){return!e||!e.length?null:e}function v(e){if(!angular.isDate(e))return;var t=isNaN(l.$options.minDate)||e.getTime()>=l.$options.minDate,n=isNaN(l.$options.maxDate)||e.getTime()<=l.$options.maxDate,r=t&&n;a.$setValidity("date",r);a.$setValidity("min",t);a.$setValidity("max",n);r&&(a.$dateValue=e)}function m(){return!a.$dateValue||isNaN(a.$dateValue.getTime())?"":h(a.$dateValue,f.dateFormat)}var f={scope:t,controller:a};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","autoclose","dateType","dateFormat","modelDateFormat","dayFormat","strictFormat","startWeek","startDate","useNative","lang","startView","minView","iconLeft","iconRight","daysOfWeekDisabled","id"],function(e){angular.isDefined(o[e])&&(f[e]=o[e])});o.bsShow&&t.$watch(o.bsShow,function(e,t){if(!l||!angular.isDefined(e))return;angular.isString(e)&&(e=!!e.match(/true|,?(datepicker),?/i));e===!0?l.show():l.hide()});var l=s(n,a,f);f=l.$options;u&&f.useNative&&(f.dateFormat="yyyy-MM-dd");var c=f.lang,h=function(e,t){return r.formatDate(e,t,c)},p=i({format:f.dateFormat,lang:c,strict:f.strictFormat});angular.forEach(["minDate","maxDate"],function(e){angular.isDefined(o[e])&&o.$observe(e,function(t){l.$options[e]=p.getDateForAttribute(e,t);!isNaN(l.$options[e])&&l.$build(!1);v(a.$dateValue)})});t.$watch(o.ngModel,function(e,t){l.update(a.$dateValue)},!0);angular.isDefined(o.disabledDates)&&t.$watch(o.disabledDates,function(e,t){e=d(e);t=d(t);e&&l.updateDisabledDates(e)});a.$parsers.unshift(function(e){if(!e){a.$setValidity("date",!0);return null}var t=p.parse(e,a.$dateValue);if(!t||isNaN(t.getTime())){a.$setValidity("date",!1);return}v(t);return f.dateType==="string"?h(t,f.modelDateFormat||f.dateFormat):f.dateType==="number"?a.$dateValue.getTime():f.dateType==="unix"?a.$dateValue.getTime()/1e3:f.dateType==="iso"?a.$dateValue.toISOString():new Date(a.$dateValue)});a.$formatters.push(function(e){var t;angular.isUndefined(e)||e===null?t=NaN:angular.isDate(e)?t=e:f.dateType==="string"?t=p.parse(e,null,f.modelDateFormat):f.dateType==="unix"?t=new Date(e*1e3):t=new Date(e);a.$dateValue=t;return m()});a.$render=function(){n.val(m())};t.$on("$destroy",function(){l&&l.destroy();f=null;l=null})}}}]).provider("datepickerViews",function(){function t(e,t){var n=[];while(e.length>0)n.push(e.splice(0,t));return n}function n(e,t){return(e%t+t)%t}var e=this.defaults={dayFormat:"dd",daySplit:7};this.$get=["$dateFormatter","$dateParser","$sce",function(e,r,i){return function(s){var o=s.$scope,u=s.$options,a=u.lang,f=function(t,n){return e.formatDate(t,n,a)},l=r({format:u.dateFormat,lang:a,strict:u.strictFormat}),c=e.weekdaysShort(a),h=c.slice(u.startWeek).concat(c.slice(0,u.startWeek)),p=i.trustAsHtml('<th class="dow text-center">'+h.join('</th><th class="dow text-center">')+"</th>"),d=s.$date||(u.startDate?l.getDateForAttribute("startDate",u.startDate):new Date),v={year:d.getFullYear(),month:d.getMonth(),date:d.getDate()},m=d.getTimezoneOffset()*6e4,g=[{format:u.dayFormat,split:7,steps:{month:1},update:function(e,t){if(!this.built||t||e.getFullYear()!==v.year||e.getMonth()!==v.month){angular.extend(v,{year:s.$date.getFullYear(),month:s.$date.getMonth(),date:s.$date.getDate()});s.$build()}else if(e.getDate()!==v.date){v.date=s.$date.getDate();s.$updateSelected()}},build:function(){var e=new Date(v.year,v.month,1),r=e.getTimezoneOffset(),i=new Date(+e-n(e.getDay()-u.startWeek,7)*864e5),a=i.getTimezoneOffset(),c=(new Date).toDateString();a!==r&&(i=new Date(+i+(a-r)*6e4));var h=[],d;for(var m=0;m<42;m++){d=l.daylightSavingAdjust(new Date(i.getFullYear(),i.getMonth(),i.getDate()+m));h.push({date:d,isToday:d.toDateString()===c,label:f(d,this.format),selected:s.$date&&this.isSelected(d),muted:d.getMonth()!==v.month,disabled:this.isDisabled(d)})}o.title=f(e,u.monthTitleFormat);o.showLabels=!0;o.labels=p;o.rows=t(h,this.split);this.built=!0},isSelected:function(e){return s.$date&&e.getFullYear()===s.$date.getFullYear()&&e.getMonth()===s.$date.getMonth()&&e.getDate()===s.$date.getDate()},isDisabled:function(e){var t=e.getTime();if(t<u.minDate||t>u.maxDate)return!0;if(u.daysOfWeekDisabled.indexOf(e.getDay())!==-1)return!0;if(u.disabledDateRanges)for(var n=0;n<u.disabledDateRanges.length;n++)if(t>=u.disabledDateRanges[n].start&&t<=u.disabledDateRanges[n].end)return!0;return!1},onKeyDown:function(e){if(!s.$date)return;var t=s.$date.getTime(),n;e.keyCode===37?n=new Date(t-864e5):e.keyCode===38?n=new Date(t-6048e5):e.keyCode===39?n=new Date(t+864e5):e.keyCode===40&&(n=new Date(t+6048e5));this.isDisabled(n)||s.select(n,!0)}},{name:"month",format:u.monthFormat,split:4,steps:{year:1},update:function(e,t){if(!this.built||e.getFullYear()!==v.year){angular.extend(v,{year:s.$date.getFullYear(),month:s.$date.getMonth(),date:s.$date.getDate()});s.$build()}else if(e.getMonth()!==v.month){angular.extend(v,{month:s.$date.getMonth(),date:s.$date.getDate()});s.$updateSelected()}},build:function(){var e=new Date(v.year,0,1),n=[],r;for(var i=0;i<12;i++){r=new Date(v.year,i,1);n.push({date:r,label:f(r,this.format),selected:s.$isSelected(r),disabled:this.isDisabled(r)})}o.title=f(r,u.yearTitleFormat);o.showLabels=!1;o.rows=t(n,this.split);this.built=!0},isSelected:function(e){return s.$date&&e.getFullYear()===s.$date.getFullYear()&&e.getMonth()===s.$date.getMonth()},isDisabled:function(e){var t=+(new Date(e.getFullYear(),e.getMonth()+1,0));return t<u.minDate||e.getTime()>u.maxDate},onKeyDown:function(e){if(!s.$date)return;var t=s.$date.getMonth(),n=new Date(s.$date);e.keyCode===37?n.setMonth(t-1):e.keyCode===38?n.setMonth(t-4):e.keyCode===39?n.setMonth(t+1):e.keyCode===40&&n.setMonth(t+4);this.isDisabled(n)||s.select(n,!0)}},{name:"year",format:u.yearFormat,split:4,steps:{year:12},update:function(e,t){if(!this.built||t||parseInt(e.getFullYear()/20,10)!==parseInt(v.year/20,10)){angular.extend(v,{year:s.$date.getFullYear(),month:s.$date.getMonth(),date:s.$date.getDate()});s.$build()}else if(e.getFullYear()!==v.year){angular.extend(v,{year:s.$date.getFullYear(),month:s.$date.getMonth(),date:s.$date.getDate()});s.$updateSelected()}},build:function(){var e=v.year-v.year%(this.split*3),n=[],r;for(var i=0;i<12;i++){r=new Date(e+i,0,1);n.push({date:r,label:f(r,this.format),selected:s.$isSelected(r),disabled:this.isDisabled(r)})}o.title=n[0].label+"-"+n[n.length-1].label;o.showLabels=!1;o.rows=t(n,this.split);this.built=!0},isSelected:function(e){return s.$date&&e.getFullYear()===s.$date.getFullYear()},isDisabled:function(e){var t=+(new Date(e.getFullYear()+1,0,0));return t<u.minDate||e.getTime()>u.maxDate},onKeyDown:function(e){if(!s.$date)return;var t=s.$date.getFullYear(),n=new Date(s.$date);e.keyCode===37?n.setYear(t-1):e.keyCode===38?n.setYear(t-4):e.keyCode===39?n.setYear(t+1):e.keyCode===40&&n.setYear(t+4);this.isDisabled(n)||s.select(n,!0)}}];return{views:u.minView?Array.prototype.slice.call(g,u.minView):g,viewDate:v}}}]});