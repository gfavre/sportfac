/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.typeahead",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$typeahead",function(){var e=this.defaults={animation:"am-fade",prefixClass:"typeahead",prefixEvent:"$typeahead",placement:"bottom-left",template:"typeahead/typeahead.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,minLength:1,filter:"filter",limit:6,comparator:""};this.$get=["$window","$rootScope","$tooltip","$timeout",function(t,n,r,i){function o(t,n,s){var o={},u=angular.extend({},e,s);o=r(t,u);var a=s.scope,f=o.$scope;f.$resetMatches=function(){f.$matches=[];f.$activeIndex=0};f.$resetMatches();f.$activate=function(e){f.$$postDigest(function(){o.activate(e)})};f.$select=function(e,t){f.$$postDigest(function(){o.select(e)})};f.$isVisible=function(){return o.$isVisible()};o.update=function(e){f.$matches=e;f.$activeIndex>=e.length&&(f.$activeIndex=0)};o.activate=function(e){f.$activeIndex=e};o.select=function(e){var t=f.$matches[e].value;n.$setViewValue(t);n.$render();f.$resetMatches();a&&a.$digest();f.$emit(u.prefixEvent+".select",t,e,o)};o.$isVisible=function(){return!u.minLength||!n?!!f.$matches.length:f.$matches.length&&angular.isString(n.$viewValue)&&n.$viewValue.length>=u.minLength};o.$getIndex=function(e){var t=f.$matches.length,n=t;if(!t)return;for(n=t;n--;)if(f.$matches[n].value===e)break;if(n<0)return;return n};o.$onMouseDown=function(e){e.preventDefault();e.stopPropagation()};o.$onKeyDown=function(e){if(!/(38|40|13)/.test(e.keyCode))return;if(o.$isVisible()){e.preventDefault();e.stopPropagation()}e.keyCode===13&&f.$matches.length?o.select(f.$activeIndex):e.keyCode===38&&f.$activeIndex>0?f.$activeIndex--:e.keyCode===40&&f.$activeIndex<f.$matches.length-1?f.$activeIndex++:angular.isUndefined(f.$activeIndex)&&(f.$activeIndex=0);f.$digest()};var l=o.show;o.show=function(){l();i(function(){o.$element.on("mousedown",o.$onMouseDown);u.keyboard&&t.on("keydown",o.$onKeyDown)},0,!1)};var c=o.hide;o.hide=function(){o.$element.off("mousedown",o.$onMouseDown);u.keyboard&&t.off("keydown",o.$onKeyDown);c()};return o}var s=angular.element(t.document.body);o.defaults=e;return o}]}).directive("bsTypeahead",["$window","$parse","$q","$typeahead","$parseOptions",function(e,t,n,r,i){var s=r.defaults;return{restrict:"EAC",require:"ngModel",link:function(t,n,o,u){var a={scope:t};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","filter","limit","minLength","watchOptions","selectMode","comparator","id"],function(e){angular.isDefined(o[e])&&(a[e]=o[e])});var f=a.filter||s.filter,l=a.limit||s.limit,c=a.comparator||s.comparator,h=o.ngOptions;f&&(h+=" | "+f+":$viewValue");c&&(h+=":"+c);l&&(h+=" | limitTo:"+l);var p=i(h),d=r(n,u,a);if(a.watchOptions){var v=p.$match[7].replace(/\|.+/,"").replace(/\(.*\)/g,"").trim();t.$watch(v,function(e,n){p.valuesFn(t,u).then(function(e){d.update(e);u.$render()})},!0)}t.$watch(o.ngModel,function(e,n){t.$modelValue=e;p.valuesFn(t,u).then(function(t){if(a.selectMode&&!t.length&&e.length>0){u.$setViewValue(u.$viewValue.substring(0,u.$viewValue.length-1));return}t.length>l&&(t=t.slice(0,l));var n=d.$isVisible();n&&d.update(t);if(t.length===1&&t[0].value===e)return;!n&&d.update(t);u.$render()})});u.$formatters.push(function(e){var t=p.displayValue(e);return t===undefined?"":t});u.$render=function(){if(u.$isEmpty(u.$viewValue))return n.val("");var e=d.$getIndex(u.$modelValue),t=angular.isDefined(e)?d.$scope.$matches[e].label:u.$viewValue;t=angular.isObject(t)?p.displayValue(t):t;n.val(t?t.toString().replace(/<(?:.|\n)*?>/gm,"").trim():"")};t.$on("$destroy",function(){d&&d.destroy();a=null;d=null})}}}]);