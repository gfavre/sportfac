/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.timepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.helpers.dateFormatter","mgcrea.ngStrap.tooltip"]).provider("$timepicker",function(){var e=this.defaults={animation:"am-fade",prefixClass:"timepicker",placement:"bottom-left",template:"timepicker/timepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!0,timeType:"date",timeFormat:"shortTime",modelTimeFormat:null,autoclose:!1,minTime:-Infinity,maxTime:+Infinity,length:5,hourStep:1,minuteStep:5,iconUp:"glyphicon glyphicon-chevron-up",iconDown:"glyphicon glyphicon-chevron-down",arrowBehavior:"pager"};this.$get=["$window","$document","$rootScope","$sce","$dateFormatter","$tooltip","$timeout",function(t,n,r,i,s,o,u){function c(t,n,r){function x(e,n){if(t[0].createTextRange){var r=t[0].createTextRange();r.collapse(!0);r.moveStart("character",e);r.moveEnd("character",n);r.select()}else if(t[0].setSelectionRange)t[0].setSelectionRange(e,n);else if(angular.isUndefined(t[0].selectionStart)){t[0].selectionStart=e;t[0].selectionEnd=n}}function T(){t[0].focus()}var i=o(t,angular.extend({},e,r)),a=r.scope,c=i.$options,h=i.$scope,p=c.lang,d=function(e,t){return s.formatDate(e,t,p)},v=0,m=n.$dateValue||new Date,g={hour:m.getHours(),meridian:m.getHours()<12,minute:m.getMinutes(),second:m.getSeconds(),millisecond:m.getMilliseconds()},y=s.getDatetimeFormat(c.timeFormat,p),b=s.hoursFormat(y),w=s.timeSeparator(y),E=s.minutesFormat(y),S=s.showAM(y);h.$iconUp=c.iconUp;h.$iconDown=c.iconDown;h.$select=function(e,t){i.select(e,t)};h.$moveIndex=function(e,t){i.$moveIndex(e,t)};h.$switchMeridian=function(e){i.switchMeridian(e)};i.update=function(e){if(angular.isDate(e)&&!isNaN(e.getTime())){i.$date=e;angular.extend(g,{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisecond:e.getMilliseconds()});i.$build()}else i.$isBuilt||i.$build()};i.select=function(e,t,r){if(!n.$dateValue||isNaN(n.$dateValue.getTime()))n.$dateValue=new Date(1970,0,1);angular.isDate(e)||(e=new Date(e));t===0?n.$dateValue.setHours(e.getHours()):t===1&&n.$dateValue.setMinutes(e.getMinutes());n.$setViewValue(angular.copy(n.$dateValue));n.$render();c.autoclose&&!r&&u(function(){i.hide(!0)})};i.switchMeridian=function(e){if(!n.$dateValue||isNaN(n.$dateValue.getTime()))return;var t=(e||n.$dateValue).getHours();n.$dateValue.setHours(t<12?t+12:t-12);n.$setViewValue(angular.copy(n.$dateValue));n.$render()};i.$build=function(){var e,t=h.midIndex=parseInt(c.length/2,10),n=[],r;for(e=0;e<c.length;e++){r=new Date(1970,0,1,g.hour-(t-e)*c.hourStep);n.push({date:r,label:d(r,b),selected:i.$date&&i.$isSelected(r,0),disabled:i.$isDisabled(r,0)})}var s=[],o;for(e=0;e<c.length;e++){o=new Date(1970,0,1,0,g.minute-(t-e)*c.minuteStep);s.push({date:o,label:d(o,E),selected:i.$date&&i.$isSelected(o,1),disabled:i.$isDisabled(o,1)})}var u=[];for(e=0;e<c.length;e++)u.push([n[e],s[e]]);h.rows=u;h.showAM=S;h.isAM=(i.$date||n[t].date).getHours()<12;h.timeSeparator=w;i.$isBuilt=!0};i.$isSelected=function(e,t){if(!i.$date)return!1;if(t===0)return e.getHours()===i.$date.getHours();if(t===1)return e.getMinutes()===i.$date.getMinutes()};i.$isDisabled=function(e,t){var n;t===0?n=e.getTime()+g.minute*6e4:t===1&&(n=e.getTime()+g.hour*36e5);return n<c.minTime*1||n>c.maxTime*1};h.$arrowAction=function(e,t){c.arrowBehavior==="picker"?i.$setTimeByStep(e,t):i.$moveIndex(e,t)};i.$setTimeByStep=function(e,t){var n=new Date(i.$date),r=n.getHours(),s=d(n,b).length,o=n.getMinutes(),u=d(n,E).length;t===0?n.setHours(r-parseInt(c.hourStep,10)*e):n.setMinutes(o-parseInt(c.minuteStep,10)*e);i.select(n,t,!0)};i.$moveIndex=function(e,t){var n;if(t===0){n=new Date(1970,0,1,g.hour+e*c.length,g.minute);angular.extend(g,{hour:n.getHours()})}else if(t===1){n=new Date(1970,0,1,g.hour,g.minute+e*c.length*c.minuteStep);angular.extend(g,{minute:n.getMinutes()})}i.$build()};i.$onMouseDown=function(e){e.target.nodeName.toLowerCase()!=="input"&&e.preventDefault();e.stopPropagation();if(l){var t=angular.element(e.target);t[0].nodeName.toLowerCase()!=="button"&&(t=t.parent());t.triggerHandler("click")}};i.$onKeyDown=function(e){if(!/(38|37|39|40|13)/.test(e.keyCode)||e.shiftKey||e.altKey)return;e.preventDefault();e.stopPropagation();if(e.keyCode===13)return i.hide(!0);var t=new Date(i.$date),n=t.getHours(),r=d(t,b).length,s=t.getMinutes(),o=d(t,E).length,u=/(37|39)/.test(e.keyCode),f=2+S*1;u&&(e.keyCode===37?v=v<1?f-1:v-1:e.keyCode===39&&(v=v<f-1?v+1:0));var l=[0,r];if(v===0){e.keyCode===38?t.setHours(n-parseInt(c.hourStep,10)):e.keyCode===40&&t.setHours(n+parseInt(c.hourStep,10));r=d(t,b).length;l=[0,r]}else if(v===1){e.keyCode===38?t.setMinutes(s-parseInt(c.minuteStep,10)):e.keyCode===40&&t.setMinutes(s+parseInt(c.minuteStep,10));o=d(t,E).length;l=[r+1,r+1+o]}else if(v===2){u||i.switchMeridian();l=[r+1+o+1,r+1+o+3]}i.select(t,v,!0);x(l[0],l[1]);a.$digest()};var N=i.init;i.init=function(){if(f&&c.useNative){t.prop("type","time");t.css("-webkit-appearance","textfield");return}if(l){t.prop("type","text");t.attr("readonly","true");t.on("click",T)}N()};var C=i.destroy;i.destroy=function(){f&&c.useNative&&t.off("click",T);C()};var k=i.show;i.show=function(){k();u(function(){i.$element.on(l?"touchstart":"mousedown",i.$onMouseDown);c.keyboard&&t.on("keydown",i.$onKeyDown)},0,!1)};var L=i.hide;i.hide=function(e){if(!i.$isShown)return;i.$element.off(l?"touchstart":"mousedown",i.$onMouseDown);c.keyboard&&t.off("keydown",i.$onKeyDown);L(e)};return i}var a=angular.element(t.document.body),f=/(ip(a|o)d|iphone|android)/ig.test(t.navigator.userAgent),l="createTouch"in t.document&&f;e.lang||(e.lang=s.getDefaultLocale());c.defaults=e;return c}]}).directive("bsTimepicker",["$window","$parse","$q","$dateFormatter","$dateParser","$timepicker",function(e,t,n,r,i,s){var o=s.defaults,u=/(ip(a|o)d|iphone|android)/ig.test(e.navigator.userAgent),a=e.requestAnimationFrame||e.setTimeout;return{restrict:"EAC",require:"ngModel",link:function(t,n,a,f){function v(e){if(!angular.isDate(e))return;var t=isNaN(l.minTime)||(new Date(e.getTime())).setFullYear(1970,0,1)>=l.minTime,n=isNaN(l.maxTime)||(new Date(e.getTime())).setFullYear(1970,0,1)<=l.maxTime,r=t&&n;f.$setValidity("date",r);f.$setValidity("min",t);f.$setValidity("max",n);if(!r)return;f.$dateValue=e}function m(){return!f.$dateValue||isNaN(f.$dateValue.getTime())?"":p(f.$dateValue,l.timeFormat)}var l={scope:t,controller:f};angular.forEach(["placement","container","delay","trigger","keyboard","html","animation","template","autoclose","timeType","timeFormat","modelTimeFormat","useNative","hourStep","minuteStep","length","arrowBehavior","iconUp","iconDown","id"],function(e){angular.isDefined(a[e])&&(l[e]=a[e])});a.bsShow&&t.$watch(a.bsShow,function(e,t){if(!c||!angular.isDefined(e))return;angular.isString(e)&&(e=!!e.match(/true|,?(timepicker),?/i));e===!0?c.show():c.hide()});u&&(l.useNative||o.useNative)&&(l.timeFormat="HH:mm");var c=s(n,f,l);l=c.$options;var h=l.lang,p=function(e,t){return r.formatDate(e,t,h)},d=i({format:l.timeFormat,lang:h});angular.forEach(["minTime","maxTime"],function(e){angular.isDefined(a[e])&&a.$observe(e,function(t){c.$options[e]=d.getTimeForAttribute(e,t);!isNaN(c.$options[e])&&c.$build();v(f.$dateValue)})});t.$watch(a.ngModel,function(e,t){c.update(f.$dateValue)},!0);f.$parsers.unshift(function(e){if(!e){f.$setValidity("date",!0);return null}var t=angular.isDate(e)?e:d.parse(e,f.$dateValue);if(!t||isNaN(t.getTime())){f.$setValidity("date",!1);return}v(t);return l.timeType==="string"?p(t,l.modelTimeFormat||l.timeFormat):l.timeType==="number"?f.$dateValue.getTime():l.timeType==="unix"?f.$dateValue.getTime()/1e3:l.timeType==="iso"?f.$dateValue.toISOString():new Date(f.$dateValue)});f.$formatters.push(function(e){var t;angular.isUndefined(e)||e===null?t=NaN:angular.isDate(e)?t=e:l.timeType==="string"?t=d.parse(e,null,l.modelTimeFormat):l.timeType==="unix"?t=new Date(e*1e3):t=new Date(e);f.$dateValue=t;return m()});f.$render=function(){n.val(m())};t.$on("$destroy",function(){c&&c.destroy();l=null;c=null})}}}]);