/**
 * angular-strap
 * @version v2.1.6 - 2015-01-11
 * @link http://mgcrea.github.io/angular-strap
 * @author Olivier Louvignes (olivier@mg-crea.com)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */"use strict";angular.module("mgcrea.ngStrap.tooltip",["mgcrea.ngStrap.helpers.dimensions"]).provider("$tooltip",function(){var e=this.defaults={animation:"am-fade",customClass:"",prefixClass:"tooltip",prefixEvent:"tooltip",container:!1,target:!1,placement:"top",template:"tooltip/tooltip.tpl.html",contentTemplate:!1,trigger:"hover focus",keyboard:!1,html:!1,show:!1,title:"",type:"",delay:0,autoClose:!1,bsEnabled:!0};this.$get=["$window","$rootScope","$compile","$q","$templateCache","$http","$animate","$sce","dimensions","$$rAF","$timeout",function(t,n,r,i,s,o,u,a,f,l,c){function m(t,i){function A(){b.$emit(m.prefixEvent+".show",s)}function _(){b.$emit(m.prefixEvent+".hide",s);if(N===M){if(O&&m.trigger==="focus")return t[0].blur();W()}}function D(){var e=m.trigger.split(" ");angular.forEach(e,function(e){if(e==="click")t.on("click",s.toggle);else if(e!=="manual"){t.on(e==="hover"?"mouseenter":"focus",s.enter);t.on(e==="hover"?"mouseleave":"blur",s.leave);o==="button"&&e!=="hover"&&t.on(p?"touchstart":"mousedown",s.$onFocusElementMouseDown)}})}function P(){var e=m.trigger.split(" ");for(var n=e.length;n--;){var r=e[n];if(r==="click")t.off("click",s.toggle);else if(r!=="manual"){t.off(r==="hover"?"mouseenter":"focus",s.enter);t.off(r==="hover"?"mouseleave":"blur",s.leave);o==="button"&&r!=="hover"&&t.off(p?"touchstart":"mousedown",s.$onFocusElementMouseDown)}}}function H(){m.trigger!=="focus"?N.on("keyup",s.$onKeyUp):t.on("keyup",s.$onFocusKeyUp)}function B(){m.trigger!=="focus"?N.off("keyup",s.$onKeyUp):t.off("keyup",s.$onFocusKeyUp)}function F(){c(function(){N.on("click",q);v.on("click",s.hide);j=!0},0,!1)}function I(){if(j){N.off("click",q);v.off("click",s.hide);j=!1}}function q(e){e.stopPropagation()}function R(e){e=e||m.target||t;var n=e[0],r=n.getBoundingClientRect();r.width===null&&(r=angular.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var i;m.container==="body"?i=f.offset(n):i=f.position(n);return angular.extend({},r,i)}function U(e,t,n,r){var i,s=e.split("-");switch(s[0]){case"right":i={top:t.top+t.height/2-r/2,left:t.left+t.width};break;case"bottom":i={top:t.top+t.height,left:t.left+t.width/2-n/2};break;case"left":i={top:t.top+t.height/2-r/2,left:t.left-n};break;default:i={top:t.top-r,left:t.left+t.width/2-n/2}}if(!s[1])return i;if(s[0]==="top"||s[0]==="bottom")switch(s[1]){case"left":i.left=t.left;break;case"right":i.left=t.left+t.width-n}else if(s[0]==="left"||s[0]==="right")switch(s[1]){case"top":i.top=t.top-r;break;case"bottom":i.top=t.top+t.height}return i}function z(e,t){N.css({top:e+"px",left:t+"px"})}function W(){clearTimeout(S);if(s.$isShown&&N!==null){m.autoClose&&I();m.keyboard&&B()}if(L){L.$destroy();L=null}if(N){N.remove();N=s.$element=null}}var s={},o=t[0].nodeName.toLowerCase(),m=s.$options=angular.extend({},e,i);s.$promise=w(m.template);var b=s.$scope=m.scope&&m.scope.$new()||n.$new();if(m.delay&&angular.isString(m.delay)){var E=m.delay.split(",").map(parseFloat);m.delay=E.length>1?{show:E[0],hide:E[1]}:E[0]}s.$id=m.id||t.attr("id")||"";m.title&&(b.title=a.trustAsHtml(m.title));b.$setEnabled=function(e){b.$$postDigest(function(){s.setEnabled(e)})};b.$hide=function(){b.$$postDigest(function(){s.hide()})};b.$show=function(){b.$$postDigest(function(){s.show()})};b.$toggle=function(){b.$$postDigest(function(){s.toggle()})};s.$isShown=b.$isShown=!1;var S,x;m.contentTemplate&&(s.$promise=s.$promise.then(function(e){var t=angular.element(e);return w(m.contentTemplate).then(function(e){var n=y('[ng-bind="content"]',t[0]);n.length||(n=y('[ng-bind="title"]',t[0]));n.removeAttr("ng-bind").html(e);return t[0].outerHTML})}));var T,N,C,k,L;s.$promise.then(function(e){angular.isObject(e)&&(e=e.data);m.html&&(e=e.replace(d,'ng-bind-html="'));e=h.apply(e);C=e;T=r(e);s.init()});s.init=function(){m.delay&&angular.isNumber(m.delay)&&(m.delay={show:m.delay,hide:m.delay});m.container==="self"?k=t:angular.isElement(m.container)?k=m.container:m.container&&(k=y(m.container));D();m.target&&(m.target=angular.isElement(m.target)?m.target:y(m.target));m.show&&b.$$postDigest(function(){m.trigger==="focus"?t[0].focus():s.show()})};s.destroy=function(){P();W();b.$destroy()};s.enter=function(){clearTimeout(S);x="in";if(!m.delay||!m.delay.show)return s.show();S=setTimeout(function(){x==="in"&&s.show()},m.delay.show)};s.show=function(){if(!m.bsEnabled||s.$isShown)return;b.$emit(m.prefixEvent+".show.before",s);var e,n;if(m.container){e=k;k[0].lastChild?n=angular.element(k[0].lastChild):n=null}else{e=null;n=t}N&&W();L=s.$scope.$new();N=s.$element=T(L,function(e,t){});N.css({top:"-9999px",left:"-9999px",display:"block",visibility:"hidden"});m.animation&&N.addClass(m.animation);m.type&&N.addClass(m.prefixClass+"-"+m.type);m.customClass&&N.addClass(m.customClass);var r=u.enter(N,e,n,A);r&&r.then&&r.then(A);s.$isShown=b.$isShown=!0;g(b);l(function(){s.$applyPlacement();N&&N.css({visibility:"visible"})});if(m.keyboard){m.trigger!=="focus"&&s.focus();H()}m.autoClose&&F()};s.leave=function(){clearTimeout(S);x="out";if(!m.delay||!m.delay.hide)return s.hide();S=setTimeout(function(){x==="out"&&s.hide()},m.delay.hide)};var O,M;s.hide=function(e){if(!s.$isShown)return;b.$emit(m.prefixEvent+".hide.before",s);O=e;M=N;var t=u.leave(N,_);t&&t.then&&t.then(_);s.$isShown=b.$isShown=!1;g(b);m.keyboard&&N!==null&&B();m.autoClose&&N!==null&&I()};s.toggle=function(){s.$isShown?s.leave():s.enter()};s.focus=function(){N[0].focus()};s.setEnabled=function(e){m.bsEnabled=e};s.$applyPlacement=function(){if(!N)return;var n=m.placement,r=/\s?auto?\s?/i,i=r.test(n);i&&(n=n.replace(r,"")||e.placement);N.addClass(m.placement);var s=R(),o=N.prop("offsetWidth"),u=N.prop("offsetHeight");if(i){var a=n,f=m.container?angular.element(document.querySelector(m.container)):t.parent(),l=R(f);a.indexOf("bottom")>=0&&s.bottom+u>l.bottom?n=a.replace("bottom","top"):a.indexOf("top")>=0&&s.top-u<l.top&&(n=a.replace("top","bottom"));(a==="right"||a==="bottom-left"||a==="top-left")&&s.right+o>l.width?n=a==="right"?"left":n.replace("left","right"):(a==="left"||a==="bottom-right"||a==="top-right")&&s.left-o<l.left&&(n=a==="left"?"right":n.replace("right","left"));N.removeClass(a).addClass(n)}var c=U(n,s,o,u);z(c.top,c.left)};s.$onKeyUp=function(e){if(e.which===27&&s.$isShown){s.hide();e.stopPropagation()}};s.$onFocusKeyUp=function(e){if(e.which===27){t[0].blur();e.stopPropagation()}};s.$onFocusElementMouseDown=function(e){e.preventDefault();e.stopPropagation();s.$isShown?t[0].blur():t[0].focus()};var j=!1;return s}function g(e){e.$$phase||e.$root&&e.$root.$$phase||e.$digest()}function y(e,t){return angular.element((t||document).querySelectorAll(e))}function w(e){return b[e]?b[e]:b[e]=i.when(s.get(e)||o.get(e)).then(function(t){if(angular.isObject(t)){s.put(e,t.data);return t.data}return t})}var h=String.prototype.trim,p="createTouch"in t.document,d=/ng-bind="/ig,v=angular.element(t.document),b={};return m}]}).directive("bsTooltip",["$window","$location","$sce","$tooltip","$$rAF",function(e,t,n,r,i){return{restrict:"EAC",scope:!0,link:function(t,s,o,u){var a={scope:t};angular.forEach(["template","contentTemplate","placement","container","target","delay","trigger","keyboard","html","animation","backdropAnimation","type","customClass","id"],function(e){angular.isDefined(o[e])&&(a[e]=o[e])});t.hasOwnProperty("title")||(t.title="");o.$observe("title",function(e){if(angular.isDefined(e)||!t.hasOwnProperty("title")){var r=t.title;t.title=n.trustAsHtml(e);angular.isDefined(r)&&i(function(){f&&f.$applyPlacement()})}});o.bsTooltip&&t.$watch(o.bsTooltip,function(e,n){angular.isObject(e)?angular.extend(t,e):t.title=e;angular.isDefined(n)&&i(function(){f&&f.$applyPlacement()})},!0);o.bsShow&&t.$watch(o.bsShow,function(e,t){if(!f||!angular.isDefined(e))return;angular.isString(e)&&(e=!!e.match(/true|,?(tooltip),?/i));e===!0?f.show():f.hide()});o.bsEnabled&&t.$watch(o.bsEnabled,function(e,t){if(!f||!angular.isDefined(e))return;angular.isString(e)&&(e=!!e.match(/true|1|,?(tooltip),?/i));e===!1?f.setEnabled(!1):f.setEnabled(!0)});var f=r(s,a);t.$on("$destroy",function(){f&&f.destroy();a=null;f=null})}}}]);